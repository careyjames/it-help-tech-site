{% if page.title %}
  <title>{{ page.title }} – {{ config.title }}</title>
{% else %}
  <title>{{ config.title }}</title>
{% endif %}
{% if page.description %}
  <meta name="description" content="{{ page.description | safe }}" />
{% else %}
  <meta name="description" content="{{ config.description | safe }}" />
{% endif %}
{#- Theme Switcher Button to toggle between dark/light #}
{# choose the right template context: page when available, otherwise section, otherwise site config #}
{% if page is defined %}
  {% set ctx = page %}
{% elif section is defined %}
  {% set ctx = section %}
{% else %}
  {% set ctx = config %}
{% endif %}
  {%- set integrity = config.extra.integrity | default(value=true) -%}
  {%- if config.extra.search_library %}{%- if config.extra.search_library == "offline" %}{% set integrity = false %}{% endif %}{% endif %}

  {%- if config.extra.js_switcher | default(value=true) %}
  {%- set js_theme="js/theme.min.js" %}
  {%- if config.extra.js_switcher_default %}
    {%- if config.extra.js_switcher_default == "light" %}{% set js_theme="js/theme_light.min.js" %}{% endif %}
  {%- endif %}
  <script src="{{                     get_url(path=js_theme                        , trailing_slash=false) | safe }}"{%- if integrity %} integrity="sha384-{{ get_hash(path=js_theme, sha_type=384, base64=true) | safe }}"{%- endif %}></script>
  {%- endif %}
<style>
:root {
  --ff: Roboto, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", "Noto Sans", Helvetica, Arial, sans-serif;
  --fm: ui-monospace, Menlo, Monaco, Consolas, "SF Mono", "Cascadia Mono", "Segoe UI Mono", "DejaVu Sans Mono", "Liberation Mono", "Roboto Mono", "Oxygen Mono", "Ubuntu Monospace", "Ubuntu Mono", "Source Code Pro", "Fira Mono", "Droid Sans Mono", "Courier New", Courier, monospace;
  color-scheme: var(--cs);
  --s1: .5rem;
  --s2: 1rem;
  --rc: .5rem;
  --br: 0.25rem;
  --bw: 0.0625rem;
  --ow: 0.1875rem;
  --fs: 1rem;
  --lh: 1.5;
  --lhh: 1.2;
  --fw: 400;
  --fh: 700;
}
:root:not(.switch) {
  --cs: dark;
  --f1: #ccc;
  --f2: #ddd;
  --c1: #111;
  --c2: #222;
  --c3: #333;
  --c4: #888;
  --a1: #f90;
  --a2: #fb0;
  --a3: #f90;
  --a4: #f90;
  --cg: #593;
  --cr: #e33;
  --h0: #191919;
  --h1: #ddd;
  --h2: #888;
  --h3: #e65;
  --h4: #e83;
  --h5: #eb6;
  --h6: #ac3;
  --h7: #8db;
  --h8: #6ae;
  --h9: #d6e;
  --ha: 160%;
}
:root.switch {
  --cs: light;
  --f1: #333;
  --f2: #222;
  --c1: #fff;
  --c2: #eee;
  --c3: #ddd;
  --c4: #555;
  --a1: #c40;
  --a2: #e60;
  --a3: #f90;
  --a4: #c40;
  --cg: #373;
  --cr: #d33;
  --h0: #f7f7f7;
  --h1: #222;
  --h2: #666;
  --h3: #a21;
  --h4: #930;
  --h5: #a50;
  --h6: #350;
  --h7: #286;
  --h8: #059;
  --h9: #a3c;
  --ha: 92%;
}
html {
  background-color: var(--c1);
  color: var(--f1);
  font-family: var(--ff);
  font-weight: var(--fw);
  font-size: var(--fs);
  line-height: var(--lh);
}
body {
  background-color: var(--c1);
  color: var(--f1);
  font-family: "JetBrains Mono", "Courier New", monospace;
  margin: 0;
}
.nav-wrapper {
  display: flex;
  width: fit-content;
  margin: 0 auto;
  padding: 0.25rem 0.75rem;
  background-color: var(--c2);
  border-radius: 2rem;
  box-shadow: 0 2px 5px rgba(0,0,0,.3);
}
.nav-wrapper ul {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  list-style: none;
  margin: 0;
  padding: 0;
  gap: 0.5rem;
}
.nav-wrapper ul li {
  display: flex;
  align-items: center;
}
.nav-wrapper ul li a {
  display: flex;
  align-items: center;
}
.homepage-hero {
  display: flex;
  flex-direction: column;
  text-align: left;
  max-width: 60rem;
  margin-inline: auto;
  padding-inline: 1rem;
}
.homepage-hero>h1,
.homepage-hero>.phone-line,
.homepage-hero>p:has(.cta-button) {
  text-align: center;
  margin-left: auto;
  margin-right: auto;
}
.homepage-hero>h2,
.homepage-hero>p:not(.phone-line):not(:has(.cta-button)) {
  text-align: left;
  width: 100%;
}
.homepage-hero h2,
.homepage-hero h3,
.homepage-hero h4,
.homepage-hero h5,
.homepage-hero h6 {
  text-align: left !important;
  margin-left: 0 !important;
  margin-right: auto !important;
}
.mode-btn {
  background: none;
  border: 0;
  padding: 0;
  cursor: pointer;
  font-size: 1.5rem;
  line-height: 1;
}
.mode-btn::before { content: "\2600\fe0f"; }
html.switch .mode-btn::before { content: "\1f319"; }
</style>





{#- Style Sheets #}
  {%- set stylesheets=config.extra.stylesheets | default(value=[ "css/abridge.css" ]) -%}
  {%- if stylesheets %}{%- for i in stylesheets %}
  <link rel="preload" href="{{ get_url(path=i, trailing_slash=false, cachebust=true) | safe }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
  {%- endfor %}{%- endif %}

  {%- if ctx.extra.stylesheets %}{%- set pagestylesheets=ctx.extra.stylesheets -%}{%- endif %}
  {%- if pagestylesheets %}{%- for i in pagestylesheets %}
  <link rel="preload" href="{{ get_url(path=i, trailing_slash=false, cachebust=true) | safe }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
  {%- endfor %}{%- endif %}
  <link rel="preload" href="{{ get_url(path='css/override.min.css', trailing_slash=false, cachebust=true) | safe }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
  {%- if stylesheets %}{%- for i in stylesheets %}
  <link rel="stylesheet" href="{{ get_url(path=i, trailing_slash=false, cachebust=true) | safe }}">
  {%- endfor %}{%- endif %}
  {%- if pagestylesheets %}{%- for i in pagestylesheets %}
  <link rel="stylesheet" href="{{ get_url(path=i, trailing_slash=false, cachebust=true) | safe }}">
  {%- endfor %}{%- endif %}
  <link rel="stylesheet" href="{{ get_url(path='css/override.min.css', trailing_slash=false, cachebust=true) | safe }}">
  </noscript>





{#- meta tags #}
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />





{#- Security: CSP, referrer #}
  {%- if config.extra.security_header_referrer %}
  <meta name="referrer" content="{{ config.extra.security_header_referrer | safe }}" />
  {%- endif %}
  {%- if config.extra.security_header_csp %}
  <meta http-equiv="Content-Security-Policy" content="{{ config.extra.security_header_csp | safe }}" />
  {%- endif %}





{#- Favicons #}
  {%- if config.extra.favicon_theme_color %}
  <meta name="theme-color" content="{{ config.extra.favicon_theme_color }}" />
  {%- endif %}

  {%- if config.extra.favicon_ms_color %}
  <meta name="msapplication-TileColor" content="{{ config.extra.favicon_ms_color }}" />
  {%- endif %}

  {%- if config.extra.webmanifest %}
  <link rel="manifest" href="{{ get_url(path=config.extra.webmanifest, trailing_slash=false) | safe }}" />
  {%- endif %}

  {%- if config.extra.favicon_mask and config.extra.favicon_mask_color %}
  <link rel="mask-icon" href="{{ get_url(path=config.extra.favicon_mask, trailing_slash=false) | safe }}" color="{{ config.extra.favicon_mask_color }}" />
  {%- endif %}

  {%- if config.extra.favicon_svg %}
  <link rel="icon" type="image/svg+xml" href="{{ get_url(path=config.extra.favicon_svg, trailing_slash=false) | safe }}" />
  {%- endif %}

  {%- if config.extra.favicon180 %}
  <link rel="apple-touch-icon" sizes="180x180" href="{{ get_url(path=config.extra.favicon180, trailing_slash=false) | safe }}" />
  {%- endif %}

  {%- if config.extra.favicon32 %}
  <link rel="icon" type="image/png" sizes="32x32" href="{{ get_url(path=config.extra.favicon32, trailing_slash=false) | safe }}" />
  {%- endif %}

  {%- if config.extra.favicon16 %}
  <link rel="icon" type="image/png" sizes="16x16" href="{{ get_url(path=config.extra.favicon16, trailing_slash=false) | safe }}" />
  {%- endif %}





{#- Style Sheets Preload #}
  {%- set integrity = config.extra.integrity | default(value=true) -%}
  {%- if config.extra.search_library %}{%- if config.extra.search_library == "offline" %}{% set integrity = false %}{% endif %}{% endif %}

{%- if config.extra.fonts %}{%- for i in config.extra.fonts %}
  {%- if i.url is matching("^http[s]?://") %}
  <link rel="preload" as="style" class="preStyle" href="{{ i.url | safe }}" crossorigin="anonymous" />
  {%- else %}
  <link rel="preload" as="font" href="{{ get_url(path=i.url, trailing_slash=false) | safe }}" type="font/woff2" crossorigin />
  {%- endif %}
{%- endfor %}{%- endif %}

{%- if config.extra.fontawesome %}
  <link rel="preload" as="style" class="preStyle" href="{{ config.extra.fontawesome | safe }}" crossorigin="anonymous" />
{%- endif %}

{%- if config.extra.math or ctx.extra.math %}

  {%- set katex_css=config.extra.katex_css | default(value="katex.min.css") -%}
  {%- if katex_css %}{%- if katex_css is matching("^http[s]?://") %}
  <link rel="preload" as="style" class="preStyle" href="{{ katex_css | safe }}"{%- if integrity and config.extra.katex_css_integrity %} integrity="{{ config.extra.katex_css_integrity | safe }}"{%- endif %} crossorigin="anonymous" />
  {%- else %}
  <link rel="preload" as="style" class="preStyle" href="{{ get_url(path=katex_css, trailing_slash=false) }}"{%- if integrity %} integrity="sha384-{{ get_hash(path=katex_css, sha_type=384, base64=true) | safe }}"{%- endif %} />
  {%- endif %}{%- endif %}

{%- endif %}





{# choose canonical URL even for pages where `current_url` is undefined (e.g. 404) #}
{% if current_url is defined %}
  {% set page_url = current_url %}
{% else %}
  {% set page_url = config.base_url %}
{% endif %}

{# --- Open Graph & Twitter meta tags (ctx‑aware) --- #}
<meta property="og:title"       content="{{ ctx.extra.og_title       | default(value=ctx.title) }}">
<meta property="og:description" content="{{ ctx.extra.og_description | default(value=ctx.description) }}">
<meta property="og:image"       content="{{ get_url(path=ctx.extra.og_image | default(value=config.extra.default_og_image), trailing_slash=false) | safe }}">
<meta property="og:url"         content="{{ page_url | safe }}">
<meta name="twitter:url"        content="{{ page_url | safe }}">
<meta property="og:type"        content="{{ ctx.extra.og_type | default(value='website') }}">

<meta name="twitter:card"        content="{{ ctx.extra.twitter_card        | default(value='summary_large_image') }}">
<meta name="twitter:title"       content="{{ ctx.extra.twitter_title       | default(value=ctx.title) }}">
<meta name="twitter:description" content="{{ ctx.extra.twitter_description | default(value=ctx.description) }}">
<meta name="twitter:image"       content="{{ get_url(path=ctx.extra.twitter_image | default(value=config.extra.default_twitter_image), trailing_slash=false) | safe }}">

{#- Rss / Atom Feed #}

  {%- if config.generate_feeds %}
  {%- for feed in config.feed_filenames %}

  {%- if feed is containing('atom') %}
  <link rel="alternate" type="application/atom+xml" title="{{ config.title }} Atom Feed" href="{{ get_url(path=feed, trailing_slash=false, lang=lang) | safe }}" />
  {%- endif %}

  {%- if feed is containing('rss') %}
  <link rel="alternate" type="application/rss+xml" title="{{ config.title }} RSS Feed" href="{{ get_url(path=feed, trailing_slash=false, lang=lang) | safe }}" />
  {%- endif %}

  {%- endfor %}
  {%- endif %}





{#- Extra items #}
  {%- if config.extra.head_extra %}
  {{ config.extra.head_extra | safe }}
  {%- endif %}



{#- End of head partial -#}
